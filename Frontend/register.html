<!DOCTYPE html>
<html>
<head>
    <title>Register</title>
    <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <div class="container">
            <h1>Register</h1>
            <form id="registerForm" action="http://localhost:5002/auth/register" method="post" >
             <div class="input-group">
                    <label for="fullname">Full Name</label>
                    <input type="text" id="fullname" name="fullname" required>
                </div>
                <div class="input-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <div class="input-group">
                    <label for="confirm_password">Confirm Password</label>
                    <input type="password" id="confirm_password" name="confirm_password" required>
                </div>
                    <div class="input-group">
                       <label for="role">Registering as:</label>
                        <select name="role" id="role">
                        <option value="student">Student</option>
                        <option value="instructor">Instructor</option>
                        </select>
                    </div>
                <!-- Instructor Specific Fields (Hide Initially) -->
                 <div class="instructor-fields" style="display: none;">
                 <div class="input-group">
                     <label for="department">Department</label>
                      <input type="text" id="department" name="department">
                    </div>
                     <div class="input-group">
                       <label for="position">Position</label>
                        <input type="text" id="position" name="position">
                      </div>
                </div>
                <button type="submit">Register</button>
                 <p>Already have an account <a href="login.html">Login Here</a></p>
                <div class="terms-checkbox">
                   <input type="checkbox" id="terms" name="terms" required>
                   <label for="terms">I agree to the <a href="/terms">Terms of Service</a> and <a href="/privacy">Privacy Policy</a></label>
                   </div>
            </form>
            <div id="messageBox" class="message-box" style="display: none;"></div>
        </div>
      <!--<video autoplay muted loop id="myVideo">
            <source src="login.mp4" type="video/mp4">
        </video>-->
        <script>
        document.getElementById('role').addEventListener('change', function() {
        var instructorFields = document.querySelector('.instructor-fields');
         if (this.value === 'instructor') {
            instructorFields.style.display = 'block';
            } else {
            instructorFields.style.display = 'none';
            }
       });

        // Modified form submission handler
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get form data
            const formData = {
                full_name: document.getElementById('fullname').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                role: document.getElementById('role').value
            };

            // Add instructor fields if applicable
            if (formData.role === 'instructor') {
                formData.department = document.getElementById('department').value;
                formData.position = document.getElementById('position').value;
            }

            // Validate password confirmation
            const confirmPassword = document.getElementById('confirm_password').value;
            if (formData.password !== confirmPassword) {
                showMessage('Passwords do not match', 'error');
                return;
            }

            try {
                const response = await fetch('http://localhost:5002/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (data.success) {
                    showMessage('Registration successful! Redirecting to login...', 'success');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                } else {
                    showMessage(data.message || 'Registration failed', 'error');
                }
            } catch (error) {
                console.error('Registration error:', error);
                showMessage('Registration failed. Please try again.', 'error');
            }
        });

        // Helper function to show messages
        function showMessage(message, type = 'info') {
            const messageBox = document.getElementById('messageBox');
            messageBox.textContent = message;
            messageBox.className = `message-box ${type}`;
            messageBox.style.display = 'block';
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 5000);
        }
       </script>
       <style>
        .message-box {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }

        .message-box.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message-box.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        </style>
    </body>
    </html>